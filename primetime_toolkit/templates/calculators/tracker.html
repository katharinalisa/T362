{% extends 'layout.html' %}
{% block content %}
<section class="tracker-overview">
  <section class="page-header text-center py-5 bg-gradient text-white">
    <h1 class="fw-bold">Web Calculator Overview</h1>
    <p>Follow these steps to complete your personal financial roadmap.</p>
  </section>

    <div class="progress-container">
      <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="progressA11y">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p class="progress-label" id="progressLabel">0 of 12 steps completed</p>
      <div class="text-end mt-2">
        <button id="restartBtn" class="btn btn-outline-danger btn-sm">Restart Progress</button>
      </div>
    </div>

  <div class="container py-5">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 2</div>
            <h5 class="fw-bold mb-2">Life Expectancy</h5>
            <p>Estimate your expected lifespan using age &amp; gender to inform long-term planning.</p>
          </div>
          <a href="{{ url_for('views.life') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 3</div>
            <h5 class="fw-bold mb-2">Assets</h5>
            <p>What you own (cash, bank accounts, investments, car, property, etc.). Helps build your <strong>Net Worth</strong>.</p>
          </div>
          <a href="{{ url_for('views.assets') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 4</div>
            <h5 class="fw-bold mb-2">Liabilities &amp; Savings</h5>
            <p>What you owe (credit cards, loans, HECS/HELP, mortgage). Reducing liabilities increases <strong>Net Worth</strong>.</p>
          </div>
          <a href="{{ url_for('views.liabilities') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 5</div>
            <h5 class="fw-bold mb-2">Current Income</h5>
            <p>Enter all take-home income and how often itâ€™s paid to feed the budget maths.</p>
          </div>
          <a href="{{ url_for('views.income') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 6</div>
            <h5 class="fw-bold mb-2">Current Expenses</h5>
            <p>Itemise spending by category &amp; frequency; auto-converts to weekly and annual totals.</p>
          </div>
          <a href="{{ url_for('views.expenses') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 7</div>
            <h5 class="fw-bold mb-2">Subscriptions</h5>
            <p>Track recurring services/direct debits. Enter amount &amp; frequency; annual totals calculated.</p>
          </div>
          <a href="{{ url_for('views.subscriptions') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 8</div>
            <h5 class="fw-bold mb-2">Future Budget</h5>
            <p>Plan cost of living for each life phase, including annual/one-off and epic experiences.</p>
          </div>
          <a href="{{ url_for('views.future_budget') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 9</div>
            <h5 class="fw-bold mb-2">Epic &amp; Doc</h5>
            <p>List major one-time costs &amp; epic experiences; the sheet scales them to multi-year totals.</p>
          </div>
          <a href="{{ url_for('views.epic') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 10</div>
            <h5 class="fw-bold mb-2">Income Layers</h5>
            <p>Model how income sources change over time (employment, super, investments, pension, rent).</p>
          </div>
          <a href="{{ url_for('views.income_layers') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 11</div>
            <h5 class="fw-bold mb-2">Spending Allocation</h5>
            <p>Allocate spending by category for each phase and compare to your future budget.</p>
          </div>
          <a href="{{ url_for('views.spending') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 12</div>
            <h5 class="fw-bold mb-2">Summary</h5>
            <p>See the big picture: assets, liabilities, net worth, income, expenses and surplus/deficit.</p>
          </div>
          <a href="{{ url_for('views.summary') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 13</div>
            <h5 class="fw-bold mb-2">Super Projection</h5>
            <p>Forecast super growth over time using contributions, returns and years until retirement.</p>
          </div>
          <a href="{{ url_for('views.super') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 14</div>
            <h5 class="fw-bold mb-2">Debt Paydown</h5>
            <p>Estimate time to repay debts using principal, rate and payment (NPER-based schedule).</p>
          </div>
          <a href="{{ url_for('views.debt_paydown') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>


      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 15</div>
            <h5 class="fw-bold mb-2">Enough Calculator</h5>
            <p>Estimate the lump sum needed to fund retirement using spending needs and return/pension assumptions.</p>
          </div>
          <a href="{{ url_for('views.enough_calculator') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 15</div>
            <h5 class="fw-bold mb-2">Go to Dashboards</h5>
            <p>Visit your Dashboard to view your results visually.</p>
          </div>
          <a href="#" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>
    </div>
  </div>
</section>
<br><br>

<script>
const TOTAL_STEPS = 12;

document.addEventListener("DOMContentLoaded", updateProgressBar);
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("restartBtn")?.addEventListener("click", resetProgress);
});

function updateProgressBar() {
  const completed = JSON.parse(localStorage.getItem("completedSteps") || "[]");
  const fill = document.getElementById("progressFill");
  const label = document.getElementById("progressLabel");

  const pct = (completed.length / TOTAL_STEPS) * 100;
  fill.style.width = `${pct}%`;
  fill.classList.add("animate");
  label.textContent = `${completed.length} of ${TOTAL_STEPS} steps completed`;
  document.getElementById('progressA11y')?.setAttribute('aria-valuenow', pct.toFixed(0));
}

function resetProgress() {
  // Clear stored completion
  localStorage.removeItem("completedSteps");
  // Reset the visual bar and text
  const fill = document.getElementById("progressFill");
  const label = document.getElementById("progressLabel");
  fill.style.width = '0%';
  label.textContent = `0 of ${TOTAL_STEPS} steps completed`;
  document.getElementById('progressA11y')?.setAttribute('aria-valuenow', '0');

  // Remove any existing "Completed" badges on cards
  document.querySelectorAll('.step-card .badge.bg-success').forEach(el => el.remove());
}

function markStepComplete(stepKey) {
  let completed = JSON.parse(localStorage.getItem("completedSteps") || "[]");
  if (!completed.includes(stepKey)) {
    completed.push(stepKey);
    localStorage.setItem("completedSteps", JSON.stringify(completed));
  }
  updateProgressBar();
}

(function(){
  const completed = new Set(JSON.parse(localStorage.getItem("completedSteps") || "[]"));
  const map = {
    life: 1, assets: 2, liabilities: 3, income: 4, expenses: 5, subscriptions: 6,
    future_budget: 7, epic: 8, income_layers: 9, spending_allocation: 10,
    super: 11, debt_paydown: 12
  };
  document.querySelectorAll('.step-card').forEach(card => {
    const num = card.querySelector('.step-number')?.textContent?.match(/\d+/)?.[0];
    const key = Object.keys(map).find(k => map[k] == num);
    if (key && completed.has(key)) {
      const tag = document.createElement('div');
      tag.className = 'badge bg-success ms-auto';
      tag.textContent = 'Completed';
      card.querySelector('.fw-bold')?.insertAdjacentElement('afterend', tag);
    }
  });
})();
</script>
{% endblock %}