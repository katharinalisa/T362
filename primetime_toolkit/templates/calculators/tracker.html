{% extends 'layout.html' %}
{% block content %}

<script>
  const completionFlags = {{ completion_flags | tojson }};
  const TOTAL_STEPS = Object.keys(completionFlags).length;
  const completedCount = Object.values(completionFlags).filter(Boolean).length;

  document.addEventListener("DOMContentLoaded", () => {
    // Update progress bar
    const fill = document.getElementById("progressFill");
    const label = document.getElementById("progressLabel");
    const pct = (completedCount / TOTAL_STEPS) * 100;

    fill.style.width = `${pct}%`;
    fill.classList.add("animate");
    label.textContent = `${completedCount} of ${TOTAL_STEPS} steps completed`;
    document.getElementById('progressA11y')?.setAttribute('aria-valuenow', pct.toFixed(0));

    // Map steps to numbers
    const map = {
      life: 1, assets: 2, liabilities: 3, income: 4, expenses: 5, subscriptions: 6,
      future_budget: 7, epic: 8, income_layers: 9, spending_allocation: 10
    };

    document.querySelectorAll('.step-card').forEach(card => {
      const num = card.querySelector('.step-number')?.textContent?.match(/\d+/)?.[0];
      const key = Object.keys(map).find(k => map[k] == num);

      // Show "Completed" label
      if (key && completionFlags[key]) {
        const tag = document.createElement('div');
        tag.className = 'badge bg-success ms-auto';
        tag.textContent = 'Completed';
        card.querySelector('.fw-bold')?.insertAdjacentElement('afterend', tag);
      }

      // Locks Summary if fewer than 10 steps are complete
      if (num === '11' && completedCount < 10) {
        card.classList.add('text-muted');
        card.style.opacity = '0.6';
        card.style.pointerEvents = 'none';

        const btn = card.querySelector('a');
        if (btn) {
          btn.classList.add('btn-secondary', 'disabled');
          btn.textContent = 'Locked';
          btn.removeAttribute('href');
        }

        const desc = card.querySelector('p');
        if (desc) {
          desc.textContent = 'Complete Steps 1–10 to unlock your summary.';
        }
      }
    });
    document.getElementById("restartBtn")?.addEventListener("click", resetProgress);

    function resetProgress() {

      const fill = document.getElementById("progressFill");
      const label = document.getElementById("progressLabel");
      fill.style.width = '0%';
      label.textContent = `0 of ${TOTAL_STEPS} steps completed`;
      document.getElementById('progressA11y')?.setAttribute('aria-valuenow', '0');

      document.querySelectorAll('.step-card .badge.bg-success').forEach(el => el.remove());
    }

    document.getElementById("restartBtn")?.addEventListener("click", async () => {
    if (!confirm("Are you sure you want to reset all progress? This cannot be undone.")) return;

    try {
      const res = await fetch("/reset-tracker", { method: "POST" });
      const data = await res.json();
      if (data.success) {
        location.reload(); // Reload to reflect cleared progress
      } else {
        alert("Reset failed: " + (data.error || "Unknown error"));
      }
    } catch (err) {
      alert("Something went wrong while resetting.");
      console.error(err);
    }
  });

  });
</script>


<section class="tracker-overview">
  <section class="page-header text-center py-3 bg-gradient text-white">
    <h1
      class="display-1 section-title mb-2"
      style="font-size: 3rem; font-weight: 800; letter-spacing: -0.6px;"
    >
      Financial Calculators Overview
    </h1>
    <p>Follow these steps to complete your personal financial roadmap.</p>
  </section>

    <!-- Progress Bar -->
  <div class="progress-container text-center mt-4">
    <div class="progress-track mx-auto" id="progressA11y" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
      <div class="progress-fill" id="progressFill"></div>
      <img src="{{ url_for('static', filename='img/snail.webp') }}" alt="Snail Mascot" id="progressMascot" class="progress-mascot">
    </div>
  </div>
  <div>
    <p class="progress-label mt-3" id="progressLabel">0 of 11 steps completed</p>
  </div>

  <div class="container py-5" style="margin-top:-60px;">
    <div class="text-center my-5">
    <p class="lead mb-3">
      Need a walkthrough before diving in? Click below to view full instructions for each step below.
    </p>
    <button class="btn btn-primary btn-lg" style="background-color: #009687;" data-bs-toggle="modal" data-bs-target="#instructionsModal">
      View Full Instructions
    </button>
  </div><br>

  <!-- Modal -->
  <div class="modal fade" id="instructionsModal" tabindex="-1" aria-labelledby="instructionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="instructionsModalLabel">Big Financial Picture Instructions</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <div class="mb-4">
            <p class="lead">
              Hey there! Thanks for picking up a copy of <strong>Prime Time: 27 Lessons for the New Midlife</strong> and downloading this Big Financial Picture Worksheet.
            </p>
            <p>
              Think of this website as a trusted companion to my book. It’s here to help you get a clear view of where you are and where you’re headed, so you can spend more time daydreaming about that caravan trip and less time fretting over spreadsheets.
            </p>
            <p>
              As you work through each step, use the instructions like signposts – they’ll guide you gently, working alongside the steps in the book. This workbook follows the framework in Prime Time, but it’s yours to mould; adjust the categories, play with the numbers, and make it feel like home.
            </p>
            <p>
              Most of all, have fun with it. Planning for your Prime Time, and later your Epic Retirement should feel hopeful, not a chore.
            </p>
          </div>

          <div class="accordion" id="instructionsAccordion">
            {% for step in instructions %}
            <div class="accordion-item">
              <h2 class="accordion-header" id="heading{{ loop.index }}">
                <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="{{ 'true' if loop.first else 'false' }}" aria-controls="collapse{{ loop.index }}">
                  Step {{ loop.index }}: {{ step.title }}
                </button>
              </h2>
              <div id="collapse{{ loop.index }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#instructionsAccordion">
                <div class="accordion-body">
                  <p>{{ step.description }}</p>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

    <div class="row g-4">
      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 1</div>
            <h5 class="fw-bold mb-2">Life Expectancy</h5>
            <p>Estimate your expected lifespan using age &amp; gender to inform long-term planning.</p>
          </div>
          <a href="{{ url_for('views.life') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 2</div>
            <h5 class="fw-bold mb-2">Assets</h5>
            <p>What you own (cash, bank accounts, investments, car, property, etc.). Helps build your <strong>Net Worth</strong>.</p>
          </div>
          <a href="{{ url_for('views.assets') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 3</div>
            <h5 class="fw-bold mb-2">Liabilities &amp; Savings</h5>
            <p>What you owe (credit cards, loans, HECS/HELP, mortgage). Reducing liabilities increases <strong>Net Worth</strong>.</p>
          </div>
          <a href="{{ url_for('views.liabilities') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 4</div>
            <h5 class="fw-bold mb-2">Current Income</h5>
            <p>Enter all take-home income and how often it’s paid to feed the budget maths.</p>
          </div>
          <a href="{{ url_for('views.income') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 5</div>
            <h5 class="fw-bold mb-2">Current Expenses</h5>
            <p>Itemise spending by category &amp; frequency; auto-converts to weekly and annual totals.</p>
          </div>
          <a href="{{ url_for('views.expenses') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 6</div>
            <h5 class="fw-bold mb-2">Subscriptions</h5>
            <p>Track recurring services/direct debits. Enter amount &amp; frequency; annual totals calculated.</p>
          </div>
          <a href="{{ url_for('views.subscriptions') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 7</div>
            <h5 class="fw-bold mb-2">Future Budget</h5>
            <p>Plan cost of living for each life phase, including annual/one-off and epic experiences.</p>
          </div>
          <a href="{{ url_for('views.future_budget') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 8</div>
            <h5 class="fw-bold mb-2">Epic Experiences</h5>
            <p>List major one-time costs &amp; epic experiences; the sheet scales them to multi-year totals.</p>
          </div>
          <a href="{{ url_for('views.epic') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 9</div>
            <h5 class="fw-bold mb-2">Income Layers</h5>
            <p>Model how income sources change over time (employment, super, investments, pension, rent).</p>
          </div>
          <a href="{{ url_for('views.income_layers') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 10</div>
            <h5 class="fw-bold mb-2">Spending Allocation</h5>
            <p>Allocate spending by category for each phase and compare to your future budget.</p>
          </div>
          <a href="{{ url_for('views.spending_allocation') }}" class="btn btn-start mt-3 align-self-start">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 11</div>
            <h5 class="fw-bold mb-2">Summary</h5>
            <p>See the big picture: assets, liabilities, net worth, income, expenses and surplus/deficit.</p>
          </div>
          <a href="{{ url_for('views.summary') }}" class="btn btn-start mt-3 align-self-start" style="margin-left:70px;width:200px">View</a>
        </div>
      </div>

            
      <div class="col-12 mt-5">
        <div class="option-card p-5 text-center shadow-sm">
          <h2 class="display-6 fw-bold mb-4 text-success-emphasis">
            Have you completed all steps?
          </h2>
          <a href="{{ url_for('views.dashboard_web_calculator') }}" class="btn btn-start mt-3 align-self-start" style="font-weight: 600; font-size: 1.2rem; padding:15px;">
            View Your Financial Dashboard
          </a>
        </div>
      </div>

      <div style="height: 60px;"></div>
      <h3
        class="section-title mb-2 mt-5"
        style="font-size: 2rem; font-weight: 800; letter-spacing: -0.6px; text-align: center;"
      >
        This Content is not available yet
      </h3>
    </div>
        
    <div class="row mt-4">
      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100 bg-light text-muted" style="opacity: 0.6; pointer-events: none;">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 12</div>
            <h5 class="fw-bold mb-2">Super Projection</h5>
            <p>Forecast super growth over time using contributions, returns and years until retirement.</p>
          </div>
          <a class="btn btn-secondary disabled mt-3 align-self-start" style="pointer-events: none;">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100 bg-light text-muted" style="opacity: 0.6; pointer-events: none;">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 13</div>
            <h5 class="fw-bold mb-2">Debt Paydown</h5>
            <p>Estimate time to repay debts using principal, rate and payment (NPER-based schedule).</p>
          </div>
          <a class="btn btn-secondary disabled mt-3 align-self-start" style="pointer-events: none;">Start</a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="step-card d-flex flex-column justify-content-between h-100 bg-light text-muted" style="opacity: 0.6; pointer-events: none;">
          <div>
            <div class="card-icon" aria-hidden="true"></div>
            <div class="step-number">Step 14</div>
            <h5 class="fw-bold mb-2">Enough Calculator</h5>
            <p>Estimate the lump sum needed to fund retirement using spending needs and return/pension assumptions.</p>
          </div>
          <a class="btn btn-secondary disabled mt-3 align-self-start" style="pointer-events: none;">Start</a>
        </div>
      </div>
    </div>
   </div>
  </div>
  <button id="restartBtn" class="btn btn-outline-danger btn-sm">Restart Progress</button>
</section>
<br><br>


<!-- 
<script>
const TOTAL_STEPS = 11;



(function(){
  const completed = new Set(JSON.parse(localStorage.getItem("completedSteps") || "[]"));
  const map = {
    life: 1, assets: 2, liabilities: 3, income: 4, expenses: 5, subscriptions: 6,
    future_budget: 7, epic: 8, income_layers: 9, spending_allocation: 10,
    summary: 11
  };

document.querySelectorAll('.step-card').forEach(card => {
  const num = card.querySelector('.step-number')?.textContent?.match(/\d+/)?.[0];
  const key = Object.keys(map).find(k => map[k] == num);

  if (key && completionFlags[key]) {
    const tag = document.createElement('div');
    tag.className = 'badge bg-success ms-auto';
    tag.textContent = 'Completed';
    card.querySelector('.fw-bold')?.insertAdjacentElement('afterend', tag);
  }


  if (num === '11' && completedCount < 10) {
    card.classList.add('text-muted');
    card.style.opacity = '0.6';
    card.style.pointerEvents = 'none';
    const btn = card.querySelector('a');
    if (btn) {
      btn.classList.add('btn-secondary', 'disabled');
      btn.textContent = 'Locked';
      btn.removeAttribute('href');
    }
    const desc = card.querySelector('p');
    if (desc) {
      desc.textContent = 'Complete Steps 1–10 to unlock your summary.';
    }
  }
});
    
    // Lock Summary card if Steps 1–10 are not completed
    if (num === '11' && completed.size < 10) {
      card.classList.add('text-muted');
      card.style.opacity = '0.6';
      card.style.pointerEvents = 'none';

      const btn = card.querySelector('a');
      if (btn) {
        btn.classList.add('btn-secondary', 'disabled');
        btn.textContent = 'Locked';
        btn.removeAttribute('href');
      }

      const desc = card.querySelector('p');
      if (desc) {
        desc.textContent = 'Complete Steps 1–10 to unlock your summary.';
      }
    }
  });
})();
</script> -->
{% endblock %}