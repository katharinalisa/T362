{% extends 'layout.html' %} {% block content %}
<section
  class="hero-section text-center py-4"
  style="background: linear-gradient(100deg, #eaf1fe 0%, #e6fcfa 100%);"
>
  <div class="container">
    <h1
      class="display-1 section-title mb-2"
      style="font-size: 3rem; font-weight: 800; letter-spacing: 1px;"
    >
      Your Financial Dashboard
    </h1>
    <p class="lead-p mb-4" style="font-size: 1.2rem; color: #2d3e50;">
      View your financial insights and track your progress over time.
    </p>
  </div>
</section>
<br />

<!-- Upload Spreadsheet Section -->
<div class="container" style="margin-bottom: 0.5rem;">
  <div
    class="card mx-auto shadow-lg border-0 rounded-4 p-4 mb-2"
    style="
      max-width: 400px;
      border: 2.5px solid #1a7f8c;
      background: linear-gradient(100deg, #eaf1fe 0%, #e6fcfa 100%);
    "
  >
    <div class="card-body text-center">
      <span class="fs-1 text-primary mb-2"><i class="bi bi-upload"></i></span>
      <h6><strong>Upload Completed Spreadsheet</strong></h6>
      <br />
      <form
        action="{{ url_for('views.upload_excel') }}"
        method="POST"
        enctype="multipart/form-data"
      >
        <input
          type="file"
          name="budget_file"
          class="form-control mb-2 rounded-pill"
          accept=".xlsx,.xls"
          required
        />
        <button type="submit" class="btn btn-outline-primary rounded-pill px-4">
          Upload Spreadsheet
        </button>
      </form>
    </div>
  </div>
</div>

<div class="container-fluid py-4">
  <!-- First row: three charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 style="margin-top: -35px" class="mb-2">Current Net Worth</h5><br>
        <div style="font-size:2.5rem; font-weight:700; color:#3bb3c3;">
          ${{ "{:,.2f}".format(data.net_worth) }}
        </div>
        <span class="text-muted mt-2">Calculated from your assets and liabilities</span>
        <canvas id="netWorthChart" style="max-width: 100%; max-height: 220px; display:none;"></canvas>
      </div>
    </div>
    <div class="col-md-4 ">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Assets vs Liabilities</h5>
        <canvas id="assetsLiabilitiesChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Monthly Savings</h5>
        <div style="font-size:2.5rem; font-weight:700; color:#3bb3c3;">
          ${{ "{:,.2f}".format(data.monthly_savings) }}
        </div>
        <span class="text-muted mt-2">Income minus expenses</span>

      </div>
    </div>
  </div>
  
  <!-- Second row: two wide charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Subscription Amount ($)</h5>
        <canvas id="debtPaydownChart" style="max-width: 100%; max-height: 320px;"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Monthly Expenses</h5>
        <canvas style="font-size:2.5rem; font-weight:700; color:#3bb3c3;" id="monthlyExpensesChart" style="max-width: 100%; max-height: 320px;"></canvas>
      </div>
    </div>
  </div>
  <!-- Third row: three charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Superannuation Growth</h5>
        <canvas id="superGrowthChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Expense Breakdown</h5>
        <canvas id="expenseBreakdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Drawdown Over Time</h5>
        <canvas id="drawdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
  </div>
  <!-- Fourth row: two wide charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Income Sources</h5>
        <canvas id="incomeSourcesChart" style="max-width: 100%; max-height: 320px;"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart card-soft p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18); border: 2px solid #3bb3c3; border-radius: 18px; background: #fff;">
        <h5 class="mb-2">Insurance Coverage</h5>
        <canvas id="insuranceCoverageChart" style="max-width: 100%; max-height: 320px;"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const dashboardData = {{ data|tojson }};
console.log(dashboardData);

// Assets vs Liabilities Chart
var ctxAssetsLiabilities = document.getElementById('assetsLiabilitiesChart').getContext('2d');
var assetsLiabilitiesChart = new Chart(ctxAssetsLiabilities, {
  type: 'bar',
  data: {
    labels: ['Assets', 'Liabilities'],
    datasets: [{
      label: 'Amount',
      data: [dashboardData.assets.total, dashboardData.liabilities.total],
      backgroundColor: ['#3bb3c3', '#1a7f8c']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Subscription Amount Chart
var ctxDebtPaydown = document.getElementById('debtPaydownChart').getContext('2d');
var subsLabels = dashboardData.subscriptions.items.map(item => item.label);
var subsValues = dashboardData.subscriptions.items.map(item => item.value);
var debtPaydownChart = new Chart(ctxDebtPaydown, {
  type: 'bar',
  data: {
    labels: subsLabels,
    datasets: [{
      label: 'Subscriptions',
      data: subsValues,
      backgroundColor: '#ffe066'
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Monthly Expenses Chart
var ctxMonthlyExpenses = document.getElementById('monthlyExpensesChart').getContext('2d');
var expenseLabels = dashboardData.expenses.items.map(item => item.label);
var expenseValues = dashboardData.expenses.items.map(item => item.value);
var monthlyExpensesChart = new Chart(ctxMonthlyExpenses, {
  type: 'bar',
  data: {
    labels: expenseLabels,
    datasets: [{
      label: 'Expenses',
      data: expenseValues,
      backgroundColor: '#dc3545'
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true },
      x: { title: { display: true, text: 'Expense Category' } }
    }
  }
});

// Superannuation Growth Chart
var ctxSuperGrowth = document.getElementById('superGrowthChart').getContext('2d');
var superGrowthChart = new Chart(ctxSuperGrowth, {
  type: 'line',
  data: {
    labels: dashboardData.super.years,
    datasets: [{
      label: 'Super Growth',
      data: dashboardData.super.values,
      backgroundColor: 'rgba(59,179,195,0.15)',
      borderColor: '#3bb3c3',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Expense Breakdown Chart
var ctxExpenseBreakdown = document.getElementById('expenseBreakdownChart').getContext('2d');
var expenseBreakdownChart = new Chart(ctxExpenseBreakdown, {
  type: 'bar',
  data: {
    labels: expenseLabels,
    datasets: [{
      label: 'Expenses',
      data: expenseValues,
      backgroundColor: '#dc3545'
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true },
      x: { title: { display: true, text: 'Expense Category' } }
    }
  }
});

// Drawdown Over Time Chart
var ctxDrawdownOverTime = document.getElementById('drawdownChart').getContext('2d');
var drawdownOverTimeChart = new Chart(ctxDrawdownOverTime, {
  type: 'line',
  data: {
    labels: dashboardData.drawdown_over_time.months,
    datasets: [{
      label: 'Drawdown Over Time',
      data: dashboardData.drawdown_over_time.values,
      backgroundColor: 'rgba(26,127,140,0.15)',
      borderColor: '#1a7f8c',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Income Sources Chart
var ctxIncomeSources = document.getElementById('incomeSourcesChart').getContext('2d');
var incomeLabels = dashboardData.income.items.map(item => item.label);
var incomeValues = dashboardData.income.items.map(item => item.value);
var incomeSourcesChart = new Chart(ctxIncomeSources, {
  type: 'pie',
  data: {
    labels: incomeLabels,
    datasets: [{
      label: 'Income',
      data: incomeValues,
      backgroundColor: ['#e6f571', '#1a7f8c', '#ffe066', '#198754', '#6c757d', '#5275ed', '#cc917d', '#aa1349', '#be6559']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: true } } }
});

// something
var ctxInsuranceCoverage = document.getElementById('insuranceCoverageChart').getContext('2d');
var insuranceCoverageChart = new Chart(ctxInsuranceCoverage, {
  type: 'bar',
  data: {
    labels: [],
    datasets: [{
      label: '???',
      data: [],
      backgroundColor: '#6c757d'
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});
</script>
{% endblock %}