{% extends 'layout.html' %} {% block content %}

<style>
  .dashboard-chart {
    box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18);
    transition: box-shadow 0.2s, transform 0.2s;
    border-radius: 30px;
    border: none;
    background: #fff;
  }
  .dashboard-chart:hover {
    box-shadow: 0 16px 48px rgba(34, 60, 80, 0.32);
    transform: translateY(-8px) scale(1.04);
    z-index: 2;
  }

  @keyframes fadeInSlow {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in-slow {
    animation: fadeInSlow 1.8s ease-out forwards;
    animation-delay: 1s;
  }

  .option-card {
    background: linear-gradient(100deg, #eaf1fe 0%, #e6fcfa 100%);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .option-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
  }

  .btn-start {
    background-color: #009687;
    color: #fff;
    border: none;
    transition: background-color 0.3s ease;
    text-decoration: none;
  }

  .btn-start:hover {
    background-color: #007f73; /* darker shade for hover */
    color: #fff;
  }
</style>

<section
  class="hero-section text-center py-4"
  style="width: 100vw; margin-left: calc(-50vw + 50%); margin-top: -28px">
  <div class="container"><br><br>
    <h1
      class="display-1 section-title mb-2"
      style="font-size: 3rem; font-weight: 800; text-align: center; letter-spacing: -0.6px;"
    >
      Choose how you would like to proceed
    </h1>


  <div class="container my-5">
    <div class="row justify-content-center align-items-stretch g-4">

    <!-- Download Spreadsheet -->
    <div class="col-md-5 col-lg-4 d-flex">
      <div class="card option-card compact-card text-center w-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <span class="fs-2 text-primary"><i class="bi bi-file-earmark-arrow-down"></i></span>
            <h6 class="fw-bold mt-3">Get Spreadsheet by Email</h6>
            <p class="small text-muted">Receive our Excel worksheet, fill it out offline, and upload it later for analysis.</p>
          </div>
          <form id="spreadsheetForm" action="{{ url_for('views.send_email') }}" method="POST">
            <input type="email" name="email" class="form-control mb-2 rounded-pill" placeholder="Your email" required>
            <button type="submit" class="btn btn-start rounded-pill px-4 mt-2" style="width:310px;">Send Spreadsheet</button>
            <div id="loadingSpinner" style="display:none; margin-top:10px;">
              <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">Sending...</span>
              </div>
              <span class="ms-2">Sending...</span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Web Calculator -->
    <div class="col-md-5 col-lg-4 d-flex">
      <div class="card option-card compact-card text-center w-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <span class="fs-2 text-success"><i class="bi bi-calculator"></i></span>
            <h6 class="fw-bold mt-3">Use Web Calculator</h6>
            <p class="small text-muted">Step through each calculator to build your financial roadmap manually.</p>
          </div>
          <a href="{{ url_for('views.tracker') }}" class="btn btn-start rounded-pill px-4 mt-2" style="text-decoration: none;">Start Online Calculators</a>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card upload-highlight shadow-lg border-0 rounded-4 p-4 text-center">
        <div class="card-body d-flex flex-column align-items-center">
          <span class="fs-1 text-brand mb-3"><i class="bi bi-upload"></i></span>
          <h4 class="fw-bold mb-2">Have you completed your spreadsheet?</h4>
          <p class="text-muted mb-4" style="max-width: 500px;">
            If you have completed your spreadsheet, upload it here to unlock your personalized dashboard and insights.
          </p>
          <form action="{{ url_for('views.upload_excel') }}" method="POST" enctype="multipart/form-data" style="width: 100%; max-width: 500px;">
            <input type="file" name="budget_file" id="budget_file" class="form-control mb-3 rounded-pill" accept=".xlsx,.xls" required />
            <button type="submit" id="uploadBtn" class="btn btn-brand rounded-pill px-4 py-2 w-100" disabled>
              Upload Spreadsheet
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div><br><br>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('budget_file');
  const uploadBtn = document.getElementById('uploadBtn');
  fileInput.addEventListener('change', function() {
    if (fileInput.files.length > 0) {
      uploadBtn.disabled = false;
      uploadBtn.classList.remove('btn-outline-primary');
      uploadBtn.classList.add('btn-success');
    } else {
      uploadBtn.disabled = true;
      uploadBtn.classList.remove('btn-success');
      uploadBtn.classList.add('btn-outline-primary');
    }
  });
});
</script>


<h1 id="financial-dashboard"
  class="display-1 section-title mb-2"
  style="font-size: 3rem; font-weight: 800; text-align: center; letter-spacing: -0.6px;"
  >
    Your Financial Dashboard
</h1>

    {% if data.net_worth is defined and data.net_worth is not none %}
      <p style="color:#787878">
        Here you can view your financial stability and track your progress over time. We recommend calculating your finances at least every 6 months.
      </p>
    {% else %}
      <br>
      <p class="fade-in-slow" style="font-size: 17px;">
        It looks like you havenâ€™t uploaded a spreadsheet nor completed the web calculators yet.<br>
        Please choose one of the above options to get started and come back to your <strong>Dashboard</strong> once you have completed one of them.<br>
      </p>
    {% endif %}
  </div>
</section><br><br><br>
<script>
    // Make mode available in JS
    const mode = "{{ mode }}";  // Jinja variable injected as string
    console.log("Mode:", mode);
</script>
{% if data.net_worth is defined and data.net_worth is not none and mode != 'none' %}

<div class="container-fluid py-4">
  <!-- First row: three charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 style="margin-top: -35px" class="mb-2">Current Net Worth</h5><br>
        <div style="font-size:2.5rem; font-weight:700; color:#3bb3c3;">
          {% if data.net_worth is defined and data.net_worth is not none %}
            ${{ "{:,.2f}".format(data.net_worth) }}
          {% else %}
            <span class="text-muted">Please upload a spreadsheet to calculate your net worth</span>
          {% endif %}
        </div>

        <span class="text-muted mt-2">Calculated from your assets and liabilities</span>
        <canvas id="netWorthChart" style="max-width: 100%; max-height: 220px; display:none;"></canvas>
      </div>
    </div>
    <div class="col-md-4 ">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Assets vs Liabilities</h5>
        <canvas id="assetsLiabilitiesChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Monthly Savings</h5>
        <div style="font-size:2.5rem; font-weight:700; color:#3bb3c3;">
          {% if data.net_worth is defined and data.net_worth is not none %}
            ${{ "{:,.2f}".format(data.net_worth) }}
          {% else %}
            <span class="text-muted">Please upload a spreadsheet to calculate your net worth</span>
          {% endif %}
        </div>
        <span class="text-muted mt-2">Income minus expenses</span>
      </div>
    </div>
  </div>
  
  <!-- Second row: two wide charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Subscription Amount ($)</h5>
        {% if data.subscriptions is defined and data.subscriptions is not none %}
          {% if mode == 'spreadsheet' %}
            <canvas id="debtPaydownChart" style="max-width: 100%; max-height: 320px;"></canvas>
          {% elif mode == 'summary' %}
            ${{ "{:,.2f}".format(data.subscriptions.total) }}
          {% endif %}
        {% else %}
          <span class="text-muted">Please calculate your subscriptions</span>
        {% endif %}
      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Monthly Expenses</h5>
        {% if data.expenses is defined and data.expenses is not none %}
          {% if mode == 'spreadsheet' %}
            <canvas id="monthlyExpensesChart" style="max-width: 100%; max-height: 320px;"></canvas>
          {% elif mode == 'summary' %}
            ${{ "{:,.2f}".format(data.expenses.total) }}
          {% endif %}
        {% else %}
          <span class="text-muted">Please calculate your expenses</span>
        {% endif %}
      </div>
    </div>
  </div>
  <!-- Third row: three charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Superannuation Growth</h5>
        {% if data.super is defined and data.super is not none %}
          {% if mode == 'spreadsheet' %}
            <canvas id="superGrowthChart" style="max-width: 100%; max-height: 220px;"></canvas>
          {% elif mode == 'summary' %}
            ${{ "{:,.2f}".format(data.super.total) }}
          {% endif %}
        {% else %}
          <span class="text-muted">Please calculate your superannuation growth</span>
        {% endif %}
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Expense Breakdown</h5>
        <canvas id="expenseBreakdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Drawdown Over Time</h5>
        <canvas id="drawdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
  </div>
  <!-- Fourth row: two wide charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Income Sources</h5>
        <canvas id="incomeSourcesChart" style="max-width: 100%; max-height: 320px;"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Income vs Expenses</h5>
        <canvas id="incomeExpensesChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
  </div>
</div>

{% endif %}

<!-- Chart.js scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const dashboardData = {{ data|tojson }};
console.log(dashboardData);

// Assets vs Liabilities Chart
var ctxAssetsLiabilities = document.getElementById('assetsLiabilitiesChart').getContext('2d');
var assetsLiabilitiesChart = new Chart(ctxAssetsLiabilities, {
  type: 'bar',
  data: {
    labels: ['Assets', 'Liabilities'],
    datasets: [{
      label: 'Amount',
      data: [dashboardData.assets.total, dashboardData.liabilities.total],
      backgroundColor: ['#3bb3c3', '#1a7f8c']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Subscription Amount Chart
var ctxDebtPaydown = document.getElementById('debtPaydownChart').getContext('2d');
var subsLabels = dashboardData.subscriptions.items.map(item => item.label);
var subsValues = dashboardData.subscriptions.items.map(item => item.value);
var debtPaydownChart = new Chart(ctxDebtPaydown, {
  type: 'bar',
  data: {
    labels: subsLabels,
    datasets: [{
      label: 'Subscriptions',
      data: subsValues,
      backgroundColor: '#ffe066'
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Monthly Expenses Chart
var ctxMonthlyExpenses = document.getElementById('monthlyExpensesChart').getContext('2d');
var expenseLabels = dashboardData.expenses.items.map(item => item.label);
var expenseValues = dashboardData.expenses.items.map(item => item.value);
var monthlyExpensesChart = new Chart(ctxMonthlyExpenses, {
  type: 'bar',
  data: {
    labels: expenseLabels,
    datasets: [{
      label: 'Expenses',
      data: expenseValues,
      backgroundColor: '#dc3545'
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true },
      x: { title: { display: true, text: 'Expense Category' } }
    }
  }
});

// Superannuation Growth Chart
var ctxSuperGrowth = document.getElementById('superGrowthChart').getContext('2d');
var superGrowthChart = new Chart(ctxSuperGrowth, {
  type: 'line',
  data: {
    labels: dashboardData.super.years,
    datasets: [{
      label: 'Super Growth',
      data: dashboardData.super.values,
      backgroundColor: 'rgba(59,179,195,0.15)',
      borderColor: '#3bb3c3',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Expense Breakdown Chart
/*var ctxExpenseBreakdown = document.getElementById('expenseBreakdownChart').getContext('2d');
var expenseBreakdownChart = new Chart(ctxExpenseBreakdown, {
  type: 'bar',
  data: {
    labels: expenseLabels,
    datasets: [{
      label: 'Expenses',
      data: expenseValues,
      backgroundColor: '#dc3545'
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true },
      x: { title: { display: true, text: 'Expense Category' } }
    }
  }
});*/

// Drawdown Over Time Chart
var ctxDrawdownOverTime = document.getElementById('drawdownChart').getContext('2d');
var drawdownOverTimeChart = new Chart(ctxDrawdownOverTime, {
  type: 'line',
  data: {
    labels: dashboardData.drawdown_over_time.months,
    datasets: [{
      label: 'Drawdown Over Time',
      data: dashboardData.drawdown_over_time.values,
      backgroundColor: 'rgba(26,127,140,0.15)',
      borderColor: '#1a7f8c',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// Income Sources Chart
var ctxIncomeSources = document.getElementById('incomeSourcesChart').getContext('2d');
var incomeLabels = dashboardData.income.items.map(item => item.label);
var incomeValues = dashboardData.income.items.map(item => item.value);
var incomeSourcesChart = new Chart(ctxIncomeSources, {
  type: 'pie',
  data: {
    labels: incomeLabels,
    datasets: [{
      label: 'Income',
      data: incomeValues,
      backgroundColor: ['#e6f571', '#1a7f8c', '#ffe066', '#198754', '#6c757d', '#5275ed', '#cc917d', '#aa1349', '#be6559']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: true } } }
});

// Income vs EXpenses Chart
var ctxIncomeExpenses = document.getElementById('incomeExpensesChart').getContext('2d');
var incomeExpensesChart = new Chart(ctxIncomeExpenses, {
  type: 'bar',
  data: {
    labels: ['Income', 'Expenses'],
    datasets: [{
      label: 'Amount',
      data: [dashboardData.income.total, dashboardData.expenses.total],
      backgroundColor: ['#3bb3c3', '#1a7f8c']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});

// something
var ctxInsuranceCoverage = document.getElementById('').getContext('2d');
var insuranceCoverageChart = new Chart(ctxInsuranceCoverage, {
  type: 'bar',
  data: {
    labels: [],
    datasets: [{
      label: '???',
      data: [],
      backgroundColor: '#6c757d'
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});
</script>
{% endblock %}