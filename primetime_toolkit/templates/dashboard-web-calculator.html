{% extends 'layout.html' %} {% block content %}

<style>
  .dashboard-chart {
    box-shadow: 0 8px 32px rgba(34, 60, 80, 0.18);
    transition: box-shadow 0.2s, transform 0.2s;
    border-radius: 30px;
    border: none;
    background: #fff;
  }
  .dashboard-chart:hover {
    box-shadow: 0 16px 48px rgba(34, 60, 80, 0.32);
    transform: translateY(-8px) scale(1.04);
    z-index: 2;
  }

  @keyframes fadeInSlow {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in-slow {
    animation: fadeInSlow 1.8s ease-out forwards;
    animation-delay: 1s;
  }

  .option-card {
    background: linear-gradient(100deg, #eaf1fe 0%, #e6fcfa 100%);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .option-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
  }

  .btn-start {
    background-color: #009687;
    color: #fff;
    border: none;
    transition: background-color 0.3s ease;
    text-decoration: none;
  }

  .btn-start:hover {
    background-color: #007f73;
    color: #fff;
  }
</style>

<section
  class="hero-section text-center py-4"
  style="width: 100vw; margin-left: calc(-50vw + 50%); margin-top: -28px">
  <div class="container"><br>
    <h1
      class="display-1 section-title mb-2"
      style="font-size: 3rem; font-weight: 800; text-align: center; letter-spacing: -0.6px;"
    >
      Your Financial Dashboard
    </h1>



    {% if net_worth is defined and net_worth is not none %}

    <p style="color:#787878">
      This is your Dashboard based on your <strong style="color:#007f73">Web Calculator</strong> results. Here you can view your financial stability and evaluate your current financial situation. We recommend calculating your finances at least every 6 months.
    </p>

    {% else %}
      <br>
      <p class="fade-in-slow" style="font-size: 17px;">
        It looks like you havenâ€™t uploaded a spreadsheet nor completed the web calculators yet.<br>
        Please choose one of the above options to get started and come back to your <strong>Dashboard</strong> once you have completed one of them.<br>
      </p>
    {% endif %}
  </div>
  <a href="{{ url_for('views.dashboard') }}" class="btn btn-outline-secondary mt-4">Back to Dashboard Options</a>
</section><br>


{% if net_worth is defined and net_worth is not none and mode != 'none' %}


<div class="container-fluid py-4">
  <!-- First row: three charts -->
  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 style="margin-top: -35px" class="mb-2">Current Net Worth</h5>
        <div style="font-size:2.5rem; font-weight:700; color:#198754">
          {% if net_worth is defined and net_worth is not none %}
            ${{ "{:,.2f}".format(net_worth) }}
            <canvas id="netWorthChart" style="max-width: 100%; max-height: 220px; display:none;"></canvas>
          {% endif %}
        </div>
        <span class="text-muted mt-2">Assets minus Liabilities</span>

      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Assets vs Liabilities</h5><br>
        <canvas id="assetsLiabilitiesChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Annual Surplus / Deficit</h5>
        <div style="font-size:2.5rem; font-weight:700; color:#198754;">
          {% if surplus_annual is defined and surplus_annual is not none %}
            ${{ "{:,.2f}".format(surplus_annual) }}
          {% endif %}
        </div>
        <span class="text-muted mt-2">Total Income minus Total Expenses</span>
      </div>
    </div>
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Income vs Expenses</h5>
        <canvas id="incomeVsExpensesChart" style="max-width: 100%; max-height: 200px;"></canvas>
        <span class="text-muted mt-2">All expenses including subscriptions, excluding one-offs.</span>
      </div>
    </div>
  </div>

  
  <div class="col-md-12">
    <div class="dashboard-chart p-3 text-center"
      style="height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <h5 class="mb-2">Income Sources</h5>
      <canvas id="incomeSourcesChart" style="max-width: 100%; max-height: 320px;"></canvas>
    </div>
  </div><br><br>

  <div class="row g-4 mb-5">
    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Expense Breakdown</h5>
        <canvas id="expensesBreakdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>

    <div class="col-md-6">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Drawdown Over Time</h5>
        <span class="text-muted mt-2">How long would your savings last if you were to stop making any income?</span>
        <canvas id="drawdownChart" style="max-width: 100%; max-height: 220px;"></canvas>
      </div>
    </div>
  </div>


  

  <div class="row g-4 mb-5">
    <div class="col-md-8">
      <div class="dashboard-chart p-3 text-center"
        style="height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Subscription Breakdown</h5><br>
        {% if subs_annual is defined and subs_annual is not none %}
            <canvas id="subscriptionChart" style="max-width: 100%; max-height: 220px;"></canvas>
        {% endif %}
      </div>
    </div>
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Subscription Amount ($)</h5>
        <div style="font-size:2.5rem; font-weight:700; color:#198754;">
        {% if subs_annual is defined and subs_annual is not none %}
            ${{ "{:,.2f}".format(subs_annual) }}
            <canvas id="subscriptionChart" style="max-width: 100%; max-height: 220px;"></canvas>
        {% endif %}
        </div>
      </div>
    </div>
  </div>


  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="dashboard-chart p-3 text-center"
        style="height: 320px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h5 class="mb-2">Superannuation Growth</h5>
        {% if super_total is defined and super_total is not none %}
            ${{ "{:,.2f}".format(super_total) }}
            <canvas id="superGrowthChart" style="max-width: 100%; max-height: 220px;"></canvas>
        {% endif %}
      </div>
    </div>

  </div>
  <!-- Fourth row: two wide charts -->
</div>

{% endif %}

<!-- Chart.js scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



<script>

const financialSummary = {
  income: {{ income_annual|default(0)|float }},
  expenses: {{ expenses_annual|default(0)|float }},
  surplus: {{ surplus_annual|default(0)|float }}
};


  const expensesBreakdown = {
    essentials: {{ expense_buckets_sum|float }},
    subscriptions: {{ subs_annual|float }},
    oneOffs: {{ epic_annual|float }}
  };


const dashboardData = {
  assets: { total: {{ assets_total|float }} },
  liabilities: { total: {{ liabilities_total|float }} },
  income: {
    total: {{ income_annual|float }},
    items: [
      { label: "Annual Income", value: {{ income_annual|float }} }
    ]
  },
  expenses: {
    total: {{ expenses_annual|float }},
    items: [
      { label: "Essentials", value: {{ expense_buckets_sum|default(0)|float }} },
      { label: "Subscriptions", value: {{ subs_annual|default(0)|float }} },
      { label: "One-Offs", value: {{ epic_annual|default(0)|float }} }
    ]

  },
  net_worth: {{ net_worth|float }},
  drawdown_over_time: {
    months: ["Year 1", "Year 2", "Year 3", "Year 4", "Year 5"],
    values: [{{ net_worth|float }}, {{ net_worth|float * 0.9 }}, {{ net_worth|float * 0.75 }}, {{ net_worth|float * 0.6 }}, {{ net_worth|float * 0.45 }}]
  },
  super: {
    years: ["2025", "2026", "2027", "2028", "2029"],
    values: [{{ assets_total|float * 0.1 }}, {{ assets_total|float * 0.2 }}, {{ assets_total|float * 0.3 }}, {{ assets_total|float * 0.4 }}, {{ assets_total|float * 0.5 }}]
  },
  subscriptions: {
    items: [
      { label: "Placeholder Subscription", value: 0 }
    ]
  }
};

console.log(dashboardData);



// ---------------------Start of Charts --------------------------

// --------- ASSETS VS LIABILITIES ------------

var ctxAssetsLiabilities = document.getElementById('assetsLiabilitiesChart').getContext('2d');
var assetsLiabilitiesChart = new Chart(ctxAssetsLiabilities, {
  type: 'bar',
  data: {
    labels: ['Assets', 'Liabilities'],
    datasets: [{
      label: 'Amount',
      data: [dashboardData.assets.total, dashboardData.liabilities.total],
      backgroundColor: ['#3bb3c3', '#1a7f8c']
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});


// --------- INCOME VS EXPENSES ------------

const ctxIncomeVsExpenses = document.getElementById('incomeVsExpensesChart').getContext('2d');
new Chart(ctxIncomeVsExpenses, {
  type: 'bar',
  data: {
    labels: ['Income', 'Expenses'],
    datasets: [{
      label: 'Annual Amount',
      data: [financialSummary.income, financialSummary.expenses],
      backgroundColor: ['#198754', '#dc3545']
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => `$${ctx.parsed.toLocaleString()}`
        }
      },
  
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});


// --------- INCOME SOURCES ------------

const incomeSources = {{ income_breakdown | tojson }};

const ctxIncomeSources = document.getElementById('incomeSourcesChart').getContext('2d');
const incomeLabels = incomeSources.map(item => item.label);
const incomeValues = incomeSources.map(item => item.value);

new Chart(ctxIncomeSources, {
  type: 'bar',
  data: {
    labels: incomeLabels,
    datasets: [{
      label: 'Annual Income by Source',
      data: incomeValues,
      backgroundColor: '#198754'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => `$${ctx.parsed.toLocaleString()}`
        }
      }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});


// --------- EXPENSE BREAKDOWN ------------

const ctxExpensesBreakdown = document.getElementById('expensesBreakdownChart').getContext('2d');
new Chart(ctxExpensesBreakdown, {
  type: 'bar',
  data: {
    labels: ['Essentials', 'Subscriptions', 'One-Offs'],
    datasets: [{
      label: 'Annual Cost',
      data: [
        expensesBreakdown.essentials,
        expensesBreakdown.subscriptions,
        expensesBreakdown.oneOffs
      ],
      backgroundColor: ['#6c757d', '#ffe066', '#cc917d']
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => `$${ctx.parsed.toLocaleString()}`
        }
      }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});


// --------- SUBSCRIPTIONS ------------

const subscriptionItems = {{ subs_breakdown | tojson }};

const ctxSubscriptionChart = document.getElementById('subscriptionChart').getContext('2d');
const subsLabels = subscriptionItems.map(item => item.label);
const subsValues = subscriptionItems.map(item => item.value);

new Chart(ctxSubscriptionChart, {
  type: 'bar',
  data: {
    labels: subsLabels,
    datasets: [{
      label: 'Annual Subscription Cost',
      data: subsValues,
      backgroundColor: '#ffe066'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => `$${ctx.parsed.toLocaleString()}`
        }
      }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});


// --------- NEEDED??? ------------

var ctxSuperGrowth = document.getElementById('superGrowthChart').getContext('2d');
var superGrowthChart = new Chart(ctxSuperGrowth, {
  type: 'line',
  data: {
    labels: dashboardData.super.years,
    datasets: [{
      label: 'Super Growth',
      data: dashboardData.super.values,
      backgroundColor: 'rgba(59,179,195,0.15)',
      borderColor: '#3bb3c3',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});


// --------- DRAWDOWN ------------

var ctxDrawdownOverTime = document.getElementById('drawdownChart').getContext('2d');
var drawdownOverTimeChart = new Chart(ctxDrawdownOverTime, {
  type: 'line',
  data: {
    labels: dashboardData.drawdown_over_time.months,
    datasets: [{
      label: 'Drawdown Over Time',
      data: dashboardData.drawdown_over_time.values,
      backgroundColor: 'rgba(26,127,140,0.15)',
      borderColor: '#1a7f8c',
      borderWidth: 2
    }]
  },
  options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});





</script>
{% endblock %}